{{ define "main" }}

{{/* Variables */}}
{{ $audioUrl := (index (.Resources.ByType "audio") 0) }}
{{ $image := (index (.Resources.ByType "image") 0) }}

{{/* Schema.org PodcastEpisode */}}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "PodcastEpisode",
  "name": "{{ .Title }}",
  "description": "{{ .Content | plainify | truncate 160 }}",
  "url": "{{ .Permalink }}",
  "datePublished": "{{ .Date.Format "2006-01-02" }}",
  {{- with .Params.duration }}
  {{- $parts := split . ":" }}
  "duration": "PT{{ index $parts 0 }}M{{ index $parts 1 }}S",
  {{- end }}
  {{- with $image }}
  "image": "{{ .Permalink }}",
  {{- end }}
  {{- with $audioUrl }}
  "associatedMedia": {
    "@type": "MediaObject",
    "contentUrl": "{{ .Permalink }}"
  },
  {{- end }}
  "partOfSeries": {
    "@type": "PodcastSeries",
    "name": "Podcasts",
    "url": "{{ "/podcasts/" | absURL }}"
  }
}
</script>

<div class=" mx-auto px-4 sm:px-6 lg:px-8 py-12 bg-secondary">

    {{/* Laisser 'article' en flex pour la mise en page en colonnes */}}
    <article class=" sticky lg:flex lg:space-x-12 lg:items-start">
        
        {{/* MODIFICATION 1 : Retirer 'h-full' de l'aside */}}
        <aside class="lg:w-1/3 mb-8 lg:mb-0">
            <div class="sticky top-12">
                <div class="md:hidden">
                    <header class="mb-6  ">
                        <p class="text-sm font-semibold text-tertiary uppercase">{{ .Params.subtitle | default "Podcast" }}</p>
                        <h2 class=" font-extrabold text-secondary mt-1">{{ .Title }}</h2>
                    </header>
                    {{/*  <hr class=" text-accent-primary my-8">  */}}
                    
                    {{ with .Params.guests }}
                    <div class="flex items-center gap-2 mb-8 p-4  border-l-4 border-t-4 border-accent-primary  text-primary">
                        {{ range . }}
                        <h4 class=" font-bold ">Invité(e):</h4>
                        <h4 >{{ . }}</h4>
                        {{ end }}
                    </div>
                    {{ end }}    
                </div>
                
                {{/* Image Principale */}}
                <figure class="shadow-2xl rounded-lg overflow-hidden mb-8">
                    {{ if $image }}
                        <img src="{{ $image.Permalink }}" alt="Couverture de l'épisode : {{ .Title }}" class="w-full object-cover aspect-square">
                    {{ else }}
                        <img src="{{ "/img/fallback-podcast.png" | relURL }}" alt="Couverture par défaut" class="w-full object-cover aspect-square">
                    {{ end }}
                </figure>

                {{ if $audioUrl }}
                    <audio controls controlsList="nodownload" class="w-full  bg-secondary border-5 border-accent-primary rounded-full shadow-md">
                        <source src="{{ $audioUrl.Permalink }}" type="audio/wav">
                        Votre navigateur ne supporte pas l'élément audio.
                    </audio>
                {{ else }}
                    <p class="text-red-500 text-sm italic ">Fichier audio indisponible.</p>
                {{ end }}
                
                <div class=" p-2  text-sm text-primary">
                    <p><strong>Durée :</strong> {{ .Params.duration | default "N/A" }}</p>
                    <p><strong>Publié :</strong> {{ .Date.Format "02 Janvier 2006" }}</p>
                </div>

            </div>
        </aside>

        {{/* Le conteneur du contenu principal */}}
        <div class="lg:w-2/3"> 
            <div class="hidden md:inline">
                <header class="mb-6  ">
                    <p class="text-sm font-semibold text-tertiary uppercase">{{ .Params.subtitle | default "Podcast" }}</p>
                    <h3 class=" font-extrabold text-secondary mt-1">{{ .Title }}</h3>
                </header>
                {{/*  <hr class=" text-accent-primary my-8">  */}}
                
                {{ with .Params.guests }}
                <div class="flex items-center gap-2 mb-8 p-4  border-l-4 border-t-4 border-accent-primary  text-primary">
                    {{ range . }}
                    <h4 class=" font-bold ">Invité(e):</h4>
                    <h4 >{{ . }}</h4>
                    {{ end }}
                </div>
                {{ end }}
            </div>
            

            <section class="prose prose-lg max-w-none text-primary">
                {{ .Content }}
            </section>
            
            <hr class=" text-accent-primary my-8">

            <div class=" text-sm text-text-primary">
                <h3 class="font-bold mb-2">Notes :</h3>
                <p>Retrouvez la transcription complète et les ressources mentionnées dans la description ci-dessus.</p>
            </div>

        </div>
    </article>
</div>

<div>
    {{ partial "other_podcasts.html" . }}
</div>

{{ end }}